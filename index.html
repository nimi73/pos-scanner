<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scan Products</title>
  <!-- Include the HTML5 QR Code scanner library -->
  <script src="https://unpkg.com/html5-qrcode@2.3.8/dist/html5-qrcode.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    h1 { font-size: 1.5em; }
    #reader { width: 300px; margin-bottom: 15px; }
    #cart { background: #f9f9f9; padding: 10px; list-style: none; }
    #cart li { padding: 2px 0; }
    #checkout { padding: 8px 12px; font-size: 1em; }
  </style>
</head>
<body>

  <h1>ðŸ“¦ Scan Products</h1>
  <p>Point your camera at a productâ€™s QR code. Each scan will add the item to the cart below.</p>
  
  <!-- Scanner region -->
  <div id="reader"></div>
  
  <!-- Cart display -->
  <h3>Scanned Items:</h3>
  <ul id="cart"></ul>
  
  <!-- Checkout button -->
  <button id="checkout">Checkout</button>

  <script>
    // This array will hold scanned item codes (e.g., SKUs)
    let scannedItems = [];

    // Update the cart list UI
    function updateCartDisplay() {
      const cartList = document.getElementById('cart');
      cartList.innerHTML = "";
      scannedItems.forEach(code => {
        const li = document.createElement('li');
        li.textContent = code;
        cartList.appendChild(li);
      });
    }

    // Callback when a QR code is successfully scanned
    function onScanSuccess(decodedText, decodedResult) {
      // `decodedText` is the data encoded in the QR (e.g., an SKU like "SKU001")
      console.log("Scanned code:", decodedText);
      scannedItems.push(decodedText);
      updateCartDisplay();
      // (We continue scanning; do not stop the camera so multiple items can be scanned)
    }

    // Callback for scan errors (optional)
    function onScanError(errorMessage) {
      // No action on scan failure; you could log errors here
    }

    // Start the camera scanner using Html5QrcodeScanner
    let html5QrcodeScanner = new Html5QrcodeScanner(
      "reader", { fps: 10, qrbox: 250 } );
    html5QrcodeScanner.render(onScanSuccess, onScanError);  // Start scanning&#8203;:contentReference[oaicite:0]{index=0}

    // Checkout button click handler
    document.getElementById('checkout').addEventListener('click', () => {
      if (scannedItems.length === 0) {
        alert("No items to checkout.");
        return;
      }
      // Send the scanned items to Google Apps Script web app
      fetch("YOUR_SCRIPT_WEB_APP_URL_HERE", {  // <-- replace with your Apps Script URL
        method: 'POST',
        body: new URLSearchParams({ items: scannedItems.join(',') })
      })
      .then(response => response.text())
      .then(result => {
        alert("Checkout successful!");            // notify user
        console.log("Server response:", result);  // log the response (for debugging)
        scannedItems = [];      // clear cart
        updateCartDisplay();    // update UI
      })
      .catch(error => {
        console.error("Checkout error:", error);
        alert("Checkout failed. Please try again.");
      });
    });
  </script>

</body>
</html>
